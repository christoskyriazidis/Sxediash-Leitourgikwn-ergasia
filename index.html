<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="main">
      <div class="top">
        <div>
          <table id="selectProcesses">
            <tr>
              <th>Name</th>
              <th>BurstTime</th>
              <th>ArrivalTime</th>
            </tr>
            <tr>
              <td><input type="text" /></td>
              <td><input type="number" /></td>
              <td><input type="number" /></td>
            </tr>
            <tr>
              <td><input type="text" /></td>
              <td><input type="number" /></td>
              <td><input type="number" /></td>
            </tr>
          </table>
          <div class="add-btn-div">
            <button id="add-process">add process</button>
          </div>
        </div>
      </div>
      <div class="bottom">
        <table id="processes">
          <tr>
            <th>Process</th>
            <th>arrivalTime</th>
            <th>TimeStarted</th>
            <th>TimeCompleted</th>
            <th>ResponseTime</th>
            <th>TaTime</th>
          </tr>
        </table>
      </div>
    </div>
  </body>
  <script>
    class Process {
      constructor(
        id,
        arrivalTime,
        BurstTime,
        priority,
        timeStarted = null,
        timeCompleted = null,
        responseTime = null,
        turnAroundTime = null
      ) {
        this.id = id;
        this.arrivalTime = arrivalTime;
        this.BurstTime = BurstTime;
        this.priority = priority;
        this.timeStarted = timeStarted;
        this.timeCompleted = timeCompleted;
        this.responseTime = responseTime;
        this.turnAroundTime = turnAroundTime;
      }
    }
    const processes = [];
    processes.push(new Process("A", 0, 3, 1));
    processes.push(new Process("B", 2, 6, 2));
    processes.push(new Process("C", 4, 4, 4));
    processes.push(new Process("D", 6, 5, 5));
    processes.push(new Process("E", 8, 2, 6));

    let quantum = parseInt(1);
    let time = 0;
    const requestQueue = [];
    let chillQueue = [];
    const done = [];
    let kme = "";

    function roundRobin(queue, quantum) {
      const queueCopy = queue;
      let finish = false;
      let quant2 = quantum;
      while (!finish) {
        let timeTick = true;
        //an h readyList einai 0 paei na pei pws ektelestikan oles oi diergasies
        if (queue.length > 0) {
          for (i = 0; i < queue.length; i++) {
            if (queue[i].arrivalTime <= time) {
              // console.log(time);
              //mpainei stin readyList
              requestQueue.push(queue[i]);
              //feugei apo tin oyra ton diergasiwn pou kataf8anoyn sto systhma.
              queue.splice(i, 1);
            }
          }
        }
        for (let i of chillQueue) {
          requestQueue.push(i);
        }
        chillQueue = [];
        if (requestQueue.length != 0) {
          kme = requestQueue.shift();
          console.log(kme);
          if (kme.timeStarted == null) {
            kme.timeStarted = time;
          }
          kme.BurstTime--;
          quantum--;
          if (kme.BurstTime == 0) {
            timeTick = false;
            time++;
            kme.timeCompleted = time;
            kme.turnAroundTime = time - kme.arrivalTime;
            kme.responseTime = kme.timeStarted - kme.arrivalTime;
            done.push(kme);
            kme = "";
            //to to BT einai 0 prepei na ksana ginei to quant oso htan!!!
            quantum = quant2;
          } else {
            if (quantum == 0) {
              chillQueue.push(kme);
              kme = "";
              quantum = quant2;
            } else {
              requestQueue.unshift(kme);
              kme = "";
            }
          }
        }

        if (done.length == 5) {
          break;
        }
        if (timeTick) {
          time++;
        }
      }
      fillTable();
    }

    const table = document.querySelector("#processes");
    function fillTable() {
      for (i of done) {
        let row = document.createElement("tr");
        for (j in i) {
          let td = document.createElement("td");
          // console.log(j);
          if (j != "BurstTime" && j != "priority") {
            console.log(j);
            td.innerHTML = i[j];
            row.appendChild(td);
          }
          // td.innerHTML=
          // console.log(i[j]);
        }
        table.appendChild(row);
      }
    }

    document.querySelector("#add-process").addEventListener("click", add);

    function add() {
      const processes = document.querySelector("#selectProcesses");
      let tr = document.createElement("tr");
      let td1 = document.createElement("td");
      let td2 = document.createElement("td");
      let td3 = document.createElement("td");
      td1.innerHTML = `<input type="text" />`;
      td2.innerHTML = `<input type="number" />`;
      td3.innerHTML = `<input type="number" />`;
      tr.appendChild(td1);
      tr.appendChild(td2);
      tr.appendChild(td3);
      processes.appendChild(tr);
    }
  </script>
</html>
